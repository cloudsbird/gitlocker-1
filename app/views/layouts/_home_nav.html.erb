<div data-controller="home-nav" class="border-t-8 border-black">
  <%= render "layouts/home_mobile_menu" %>
  <!-- Hero section -->
  <div class="relative bg-orange-400">
    <!-- Navigation -->
    <header class="relative z-10">
      <nav aria-label="Top">
        <!-- Secondary navigation -->
        <div class="bg-opacity-60 backdrop-blur-md backdrop-filter">
          <div class="mx-auto max-w-7xl px-3 sm:px-6 lg:px-8">
            <div class="flex h-16 items-center justify-between sm:gap-4 gap-3">
              <!-- Logo (lg+) -->
              <div>
                <a href="#">
                  <span class="sr-only">Git Locker</span>
                </a>

                <%= link_to marketplace_root_path do %>
                  <div class="flex items-center">
                    <div>
                      <%= image_tag "logo.png", class: "h-12 w-auto", alt: "" %>
                    </div>
                    <div class="hidden lg:flex lg:items-center">
                      <%= image_tag "logo-text.png", class: "h-6 w-auto ml-2", alt: "" %>
                    </div>
                  </div>
                <% end %>
              </div>
              
              <!-- Search -->
              <div class="grow flex justify-center">
                <form action="/marketplace/search" method="get" class="w-full flex items-center sm:space-x-4">
                  <!-- Hidden field to carry the filter type -->
                  <input type="hidden" name="filter_by_type" value="<%= params[:filter_by_type] %>">

                  <div class="relative w-full">
                    <input
                      type="text"
                      name="search"
                      placeholder="Search our marketplace for creators, code, categories, or languages"
                      id="productSearch"
                      class="w-full p-2 rounded-md text-black bg-slate-200 rounded-3xl"
                      value="<%= params[:search] %>"
                    >
                    <button type="submit" class="absolute inset-y-0 right-0 sm:px-4 px-2 text-black">
                      <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                      </svg>
                    </button>
                  </div>
                </form>
              </div>
               <%= link_to marketplace_root_path do %>
                  <svg class="h-6 w-6 flex-shrink-0 text-black fill-black hover:fill-white hover:text-white" fill="none" viewBox="0 0 50 50" width="50px" height="50px" aria-hidden="true">
                  <path d="M 25 1.0507812 C 24.7825 1.0507812 24.565859 1.1197656 24.380859 1.2597656 L 1.3808594 19.210938 C 0.95085938 19.550938 0.8709375 20.179141 1.2109375 20.619141 C 1.5509375 21.049141 2.1791406 21.129062 2.6191406 20.789062 L 4 19.710938 L 4 46 C 4 46.55 4.45 47 5 47 L 19 47 L 19 29 L 31 29 L 31 47 L 45 47 C 45.55 47 46 46.55 46 46 L 46 19.710938 L 47.380859 20.789062 C 47.570859 20.929063 47.78 21 48 21 C 48.3 21 48.589063 20.869141 48.789062 20.619141 C 49.129063 20.179141 49.049141 19.550938 48.619141 19.210938 L 25.619141 1.2597656 C 25.434141 1.1197656 25.2175 1.0507812 25 1.0507812 z M 35 5 L 35 6.0507812 L 41 10.730469 L 41 5 L 35 5 z"/>
                </svg>
                <% end %>
               <%= link_to marketplace_root_path do %>
                  <svg class="h-6 w-6 flex-shrink-0 text-black fill-black hover:fill-white hover:text-white" fill="none" viewBox="0 0 50 50" width="50px" height="50px" aria-hidden="true">
                  <path d="M64.3 39.6h-2.5c-.1-.5-.3-1-.6-1.5l1.7-1.7c.3-.3.3-.8 0-1.1l-3.7-3.8c-.1-.1-.3-.2-.5-.2s-.4.1-.5.2l-.6.5V13.9c0-2.1-1.7-3.7-3.7-3.7H43.7V5.1c0-.4-.3-.8-.8-.8H15.7c-.1 0-.2 0-.3.1-.3.1-.4.4-.4.7v5.1H4.7c-2.1 0-3.7 1.7-3.7 3.7v31.9c0 2.1 1.7 3.8 3.7 3.8h18.8l-1.8 7h-2.2c-.9 0-1.7.7-1.7 1.7V60c0 .9.7 1.7 1.7 1.7h19.6c.9 0 1.7-.7 1.7-1.7v-1.7c0-.9-.7-1.7-1.7-1.7H37l-1.8-7h5c-.3.3-.3.7 0 1 3.1 2.8 3.9 4.7 4.8 3.7l2.1-2.1c.3.2.7.3 1.1.4v3c0 .4.3.8.8.8h5.3c.4 0 .8-.3.8-.8v-3c.4-.1.7-.3 1.1-.4l2.1 2.1c.3.3.8.3 1.1 0l3.7-3.7c.3-.3.3-.8 0-1.1l-2-2c.2-.4.4-.8.5-1.2h2.8c.4 0 .8-.3.8-.8v-5.3c-.2-.3-.5-.6-.9-.6zM53.9 11.7c1.2 0 2.2 1 2.2 2.2v19c-.4-.2-.8-.4-1.3-.5v-2.2c0-.4-.3-.8-.8-.8v-15c0-.4-.3-.8-.8-.8h-9.7v-2h10.4zm-5 17.8c-.4 0-.8.3-.8.8v2.2c-.6.2-1.1.4-1.6.7l-1.6-1.6c-.1-.1-.3-.2-.5-.2s-.4.1-.5.2l-.2.2V15.2h8.9v14.2h-3.7zm-8.8 6.9 1.7 1.7-.6 1.5h-2.5c-.4 0-.8.3-.8.8H16.5V11.6h25.7v21.6l-2.1 2.1c-.3.3-.3.8 0 1.1zM16.5 5.8h25.7V10H16.5V5.8zM15 40.4H6V15.2h9v25.2zM2.5 45.9v-32c0-1.2 1-2.2 2.2-2.2H15v2H5.3c-.4 0-.8.3-.8.8v26.6c0 .4.3.8.8.8H38v3.8c0 .4.3.8.8.8h2.8c.2.4.3.8.5 1.2l-.5.5H4.8c-1.3-.1-2.3-1.1-2.3-2.3zm36.8 12.4V60c0 .1-.1.2-.2.2H19.5c-.1 0-.2-.1-.2-.2v-1.7c0-.1.1-.2.2-.2h19.6c.1.1.2.1.2.2zm-3.9-1.6H23.2l1.8-7h8.5l1.9 7zm28.1-11.8h-2.6c-.3 0-.6.2-.7.5-.6 1.9-1.4 2.2-.8 2.8l1.9 1.9-2.7 2.7-2-2c-.2-.2-.6-.3-.9-.1-.6.3-1.2.5-1.8.7-.3.1-.6.4-.6.7V55h-3.8v-2.8c0-.3-.2-.6-.6-.7-.6-.2-1.3-.4-1.8-.7-.3-.2-.7-.1-.9.1l-2 2-2.7-2.7.7-.7 1.2-1.2c.2-.2.3-.6.1-.9-.4-.6-.7-1.3-.9-1.9-.1-.3-.4-.5-.7-.5h-2.5v-3.8h2.3c.3 0 .6-.2.7-.6.5-2.2 1.3-2.5.7-3.1l-1.6-1.6 2.7-2.7 1.4 1.4c.2.2.6.3.9.1.7-.4 1.5-.8 2.3-1 .3-.1.5-.4.5-.7v-2h3.8v2c0 .3.2.6.5.7.8.2 1.6.6 2.3 1 .3.2.7.1.9-.1l1.4-1.4 2.7 2.7-1.6 1.6c-.2.2-.3.6-.1.9.4.7.6 1.4.8 2.2.1.3.4.6.7.6H63v3.7z"></path>
                </svg>
                <% end %>

              <!-- Cart -->
              <div>
                <%= link_to marketplace_cart_items_path, class: "group -m-2 flex items-center p-2" do %>
                <svg class="h-6 w-6 flex-shrink-0 text-black hover:text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                </svg>
                <span class="sm:ml-2 ml-1 text-sm font-medium text-black"><%= current_user&.cart_items_count || visitor_user.cart_items.size %></span>
                <span class="sr-only">items in cart, view bag</span>
                <% end %>
              </div>
              
              <!-- Notifications -->
              <div class="relative">
                <button type="button" id="notifications-button" class="flex items-center -m-2.5 p-2.5 text-gray-400 hover:text-gray-500">
                  <span class="sr-only">View notifications</span>
                  <svg class="h-6 w-6 text-black hover:text-white" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0" />
                  </svg>
                  <% if current_user&.notifications&.unread&.count.to_i > 0 %>
                    <span class="sm:ml-2 sm:text-sm text-xs font-medium text-white bg-blue-500 rounded-full sm:px-2 px-1 py-1">
                      <%= current_user.notifications.unread.count %>
                    </span>
                  <% end %>
                </button>

                <div id="notifications-dropdown" class="hidden absolute right-0 mt-2 w-96 bg-white shadow-lg rounded-lg ring-1 ring-black ring-opacity-5">
                  <div class="p-4">
                    <h3 class="text-lg font-medium text-gray-900">Notifications</h3>
                  </div>
                  <ul class="divide-y divide-gray-200">
                    <% if @notifications_index.length > 0 %>
                      <% @notifications_index.each do |notification| %>
                        <li class="p-4 hover:bg-gray-100">
                          <% if notification&.params && notification.params["message"] %>
                            <p class="text-sm text-gray-700"><%= notification&.params["message"] %></p>
                            <% unless notification.read_at %>
                              <%= link_to "Mark as Read", mark_as_read_marketplace_notification_path(notification), method: :post, class: "text-sm text-blue-500 hover:text-blue-700 ml-2 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded px-2 py-1 bg-blue-100 hover:bg-blue-200" %>
                            <% end %>
                          <% end %>
                        </li>
                      <% end %>
                    <% end %>
                    <li class="p-4 hover:bg-gray-100">
                      <a href="<%= marketplace_notifications_path %>" class="block text-center text-sm font-bold text-blue-500 hover:text-blue-700">View All Notifications</a>
                    </li>
                  </ul>
                </div>
              </div>
              
              <% if current_user %>
              <div class="relative">
                <button type="button" id="profile-button" class="flex items-center -m-2.5 p-2.5 text-gray-400 hover:text-gray-500">
                  <% if current_user.profile_picture.attached? %>
                    <%= image_tag current_user.profile_picture, class: "h-8 w-8 rounded-full bg-gray-800" %>
                  <% else %>
                    <%= image_tag "profile_placeholder.png", class: "h-8 w-8 rounded-full bg-gray-800" %>
                  <% end %>
                </button>
                <div id="profile-dropdown" class="hidden z-10 min-w-32 absolute right-0 top-10 bg-white shadow-lg rounded-md ring-1 ring-black ring-opacity-5">
                  <div class="flex flex-col divide-y">
                    <%= link_to "View Profile", marketplace_user_path(current_user), class: "text-sm inline-block text-black px-4 py-2 hover:bg-blue-500 hover:text-white font-mono" %>
                    <%= link_to "Edit Profile", edit_marketplace_user_path(current_user), class: "text-sm inline-block text-black px-4 py-2 hover:bg-blue-500 hover:text-white font-mono" %>
                    <%= link_to "My Products", products_path, class: "text-sm inline-block text-black px-4 py-2 hover:bg-blue-500 hover:text-white font-mono" %>
                    <%= link_to "Add Product", new_product_path, class: "text-sm inline-block text-black px-4 py-2 hover:bg-blue-500 hover:text-white font-mono" %>
                    <%= link_to "Write Code", "https://www.replit.com", class: "text-sm inline-block text-black px-4 py-2 hover:bg-blue-500 hover:text-white font-mono", target: :blank %>
                    <%= link_to "Coding Resources", resources_path, class: "text-sm inline-block text-black px-4 py-2 hover:bg-blue-500 hover:text-white font-mono", target: :blank %>
                    <%= link_to "Purchased Products", marketplace_purchases_path, class: "text-sm inline-block text-black px-4 py-2 hover:bg-blue-500 hover:text-white font-mono" %>
                    <%= link_to "Get Paid", seller_dashboard_path, class: "text-sm inline-block text-black px-4 py-2 hover:bg-blue-500 hover:text-white font-mono" %>
                    <%= link_to "Log out", destroy_user_session_path, data: { "turbo-method": :delete }, class: "text-sm inline-block text-black px-4 py-2 hover:bg-blue-500 hover:text-white font-mono" %>
                  </div>
                </div>
              </div>
              <% else %>
                <%= link_to "Sign in", new_user_session_path, data: { turbo: false }, class: "text-sm font-medium text-white hover:text-gray-100" %>
              <% end %>
            </div>
          </div>
        </div>
      </nav>
    </header>
  </div>
</div>

<%= render SearchDialogComponent.new(search_path: marketplace_root_path) %>
<script type="text/javascript">
  document.getElementById('notifications-button').addEventListener('click', function() {
    var dropdown = document.getElementById('notifications-dropdown');
    dropdown.classList.toggle('hidden');
  });

  // Optional: Close the dropdown when clicking outside of it
  document.addEventListener('click', function(event) {
    var button = document.getElementById('notifications-button');
    var dropdown = document.getElementById('notifications-dropdown');
    if (!button.contains(event.target) && !dropdown.contains(event.target)) {
      dropdown.classList.add('hidden');
    }
  });

  document.getElementById('profile-button').addEventListener('click', function() {
    var dropdown = document.getElementById('profile-dropdown');
    dropdown.classList.toggle('hidden');
  });

  // Optional: Close the dropdown when clicking outside of it
  document.addEventListener('click', function(event) {
    var button = document.getElementById('profile-button');
    var dropdown = document.getElementById('profile-dropdown');
    if (!button.contains(event.target) && !dropdown.contains(event.target)) {
      dropdown.classList.add('hidden');
    }
  });
</script>
